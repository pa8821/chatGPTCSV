import tkinter as tk
from tkinter import filedialog, messagebox
import csv

class CSVComparerApp:
    def __init__(self, master):
        self.master = master
        self.master.title("CSV Comparer")
        
        self.file_paths = {}
        self.column_to_compare = ""
        
        self.select_button = tk.Button(master, text="Select CSV Files", command=self.select_files)
        self.select_button.pack(pady=10)
        
        self.column_label = tk.Label(master, text="Enter column name to compare:")
        self.column_label.pack()
        self.column_entry = tk.Entry(master)
        self.column_entry.pack(pady=5)
        
        self.compare_button = tk.Button(master, text="Compare Files", command=self.compare_files)
        self.compare_button.pack(pady=5)
        
    def select_files(self):
        self.file_paths = {}
        file_paths = filedialog.askopenfilenames(filetypes=[("CSV Files", "*.csv")])
        if len(file_paths) > 0:
            messagebox.showinfo("Files Selected", "CSV files selected successfully.")
            for file_path in file_paths:
                file_name = file_path.split('/')[-1]
                self.file_paths[file_name] = file_path
        else:
            messagebox.showwarning("No File Selected", "Please select at least one CSV file.")
            
    def compare_files(self):
        if len(self.file_paths) < 2:
            messagebox.showwarning("Insufficient Files", "Please select at least two CSV files to compare.")
            return

        try:
            self.column_to_compare = self.column_entry.get().strip()
            if not self.column_to_compare:
                messagebox.showwarning("Invalid Input", "Please enter a column name to compare.")
                return

            # Read specified column from each file
            key_data = {}
            for file_name, file_path in self.file_paths.items():
                with open(file_path, 'r') as file:
                    csv_reader = csv.DictReader(file)
                    key_data[file_name] = {row[self.column_to_compare] for row in csv_reader}
            
            # Compare key data
            differences_found = False
            for file_name1, key_set1 in key_data.items():
                for file_name2, key_set2 in key_data.items():
                    if file_name1 != file_name2:
                        diff = key_set1.symmetric_difference(key_set2)
                        if diff:
                            differences_found = True
                            messagebox.showinfo("Differences Found", f"Differences found between {file_name1} and {file_name2} in column '{self.column_to_compare}':\n\n{diff}")
                    
            if not differences_found:
                messagebox.showinfo("No Differences", f"No differences found between the CSV files in column '{self.column_to_compare}'.")
        except Exception as e:
            messagebox.showerror("Error", f"Error comparing files:\n{str(e)}")
    

def main():
    root = tk.Tk()
    app = CSVComparerApp(root)
    root.mainloop()

if __name__ == "__main__":
    main()
